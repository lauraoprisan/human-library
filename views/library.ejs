<%- include('partials/header') -%>
 <!--User info-->
<% if(user){%>
 <div>
  <p><strong>User Name</strong>: <%= user.userName %></p>
</div>
<% }%>
<!--/User info-->
  <section class="title-section">
    <h1>Stories</h1>
  </section>
<!--Library content-->
  <section class="container library-content">
<!--Filter/sort-->
    <section class="filter">
<!--Filter-->
        <h3>Filter</h3>
        <form action="/library/filter"
            method="GET">
          <div class="flex-col">
            <span id="filter-country" class="chosen-btn">Country</span>
            <select id="countries-options" name="country" class="form-control">
              <% for (let i = -1; i < countries.length; i++) { %>
                <% if(i == -1){ %>
                <option value="">No selection</option>
                <% } else {  %>
                <option value="<%= countries[i] %>"><%= countries[i] %></option>
              <% }} %>
            </select>
          </div>
          <div class="flex-col">
            <span id="filter-continent">Continent</span>
            <select id="continents-options" name="continent" class="form-control hidden">
              <% for (let i = -1; i < continents.length; i++) { %>
                <% if(i == -1){ %>
                <option value="">No selection</option>
                <% } else {  %>
                <option value="<%= continents[i] %>"><%= continents[i] %></option>
              <% }} %>
            </select>
          </div>
          <button class="highlight-button filter-btn" type="submit" >Filter</button>
        </form>
<!--/Filter-->
<!--Sort-->
        <h3 class="sort-subtitle">Sort by</h3>
        <form action="/library/sortByMostLiked" 
            method="GET">
          <button class="sort-btn" type="submit" value="mostLiked" name="likes">Most liked</button>
        </form>
        <form  action="/library/sortByPopularity" 
            method="GET">
          <button class="sort-btn" type="submit"  value="popularityHigh" name="popularity">Popularity</button>
        </form>
        <form class="sort-btn" action="/library/undiscoveredTreasures" 
            method="GET">
          <button class="sort-btn" type="submit"  value="popularityLow" name="popularity">Undiscovered Treasures</button>
        </form>
<!--/Sort-->
<!--Remove all filters and sorts-->
        <a href="/library">
          <button class="remove-all-btn" type="submit" >Remove filter / sort</button>
        </a>
<!--/Remove all filters and sorts-->
    </section>
<!-- /Filter/sort-->
<!--Story snippet-->
    <section class="container stories-section">
      <ul class="stories-snippets">
        <% for(var i=0; i<stories.length; i++) {%>
          <li class="single-story">
            <!-- <span><%= stories[i].user.userName%></span> -->
            <a href="/story/<%= stories[i]._id%>">
                <div class="story-details">
                  <h2><%= stories[i].title%></h2>
                  <!--Date-->
                  <span class="date">
                    <%= stories[i].createdAt.getDate()%>.<%= stories[i].createdAt.getMonth()%>.<%= stories[i].createdAt.getFullYear()%>
                  </span>
                  <!--/Date-->
                  <!--Displaying the region and managing the comma-->
                    <span>
                      <%= stories[i].country%><%if(stories[i].country && stories[i].continent ){ %>,<%}%>
                      <%= stories[i].continent%>
                    </span>
                  <!-- /Displaying the region and managing the comma-->
                </div>
                <img class="img-fluid" src="<%= stories[i].image%>">
                <div class="story-text">
                  <% if(stories[i].textContent.split(" ").length > 30){%>
                    <p><%= stories[i].textContent.split(" ").slice(0,30).join(" ")%>...</p>
                     <% } else { %> 
                    <p><%= stories[i].textContent%></p>
                    <% } %>
                </div>
                
            
            </a>
          </li>
        <% } %>
        </ul>
    </section>
<!-- /Story snippet-->
  </section>
<!-- /Library content-->
 

 
    <!-- <% if(user){%>
      <div >
        <a  href="/profile">Return to Profile</a>
      </div>
    <%}%> -->
  

  
<%- include('partials/footer') -%>